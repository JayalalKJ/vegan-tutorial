---
title: "Write-up of vegan Tutorial"
author: "hlowman"
date: "6/4/2020"
output: html_document
---

### Vegan tutorial by An Bui (UCSB)

This is an R Markdown document in which I work through the vegan package tutorial for use in analyzing community data.

First, I will load the necessary packages and data:

```{r setup}

# Load libraries.
#library(tidyverse) # Loads the tidyverse, including ggplot2.
library(ggplot2)
library(dplyr)
library(tidyr)
library(purrr)
library(readr)
library(tibble)
library(stringr)
library(forcats) # Loading these until I can get the tidyverse working...
library(vegan) # Loads the vegan package, which we will be exploring.
library(ggvegan) # Loads package to facilitate plotting from vegan in ggplot2.

# Load data.

birds <- read.csv("bta_snm_vbirds.csv") %>% # Bird community data.
  rename(site = X) %>%
  column_to_rownames("site") # Makes site numbers into row names.
# This data is sites (row) and bird species (column); all data entries are counts.

env <- read.csv("bta_snm_vfield.csv") # Environmental variables.
# This data is sites (X), stem density or # per hectare (all_stem_dens),  large stem basal area (big_stem_bas), percent canopy cover (can_cov_meas), mean canopy height (can_heig_mea), and ecological landtype (ELT).

site_type <- env %>% 
  select(X, ELT) %>% # Sets up metadata dataframe for use later.
  rename(site = X, landtype = ELT)

site_type$sitec <- as.character(site_type$site) # Create character column, otherwise below will not work.

```

## How speciose are my communities?

specnumber() will tell you the number of species within each sample. You can then run an analysis of variance to ask if mean species richness is significantly different across sites.

```{r specnum}

sppr <- specnumber(birds) 

#spprdf <- as.data.frame(sppr)%>%
#  rowid_to_column(var='name') # Adds in a new column of sites for later use.

# To run an anova on the data, use a similar format as other models : response ~ dependent, data = environmental grouping

sppr_aov <- aov(sppr ~ landtype, data = site_type)
summary(sppr_aov)

```

There is no significant difference in species richness between ecological landtypes (p = 0.06). But, let's examine a plot of the data in any case.

```{r specplot}

sppr_df <- sppr %>% 
  enframe() %>% 
  full_join(site_type, by = c("name" = "sitec")) # "name" refers to the hidden column of characters numbering each of the sppr dataset values.

pal <- c("lightsalmon1", "tan4", "springgreen3")

plot_sppr <- ggplot(sppr_df, aes(x = landtype, y = value, fill = landtype)) +
  geom_boxplot() +
  scale_fill_manual(values = pal) +
  scale_x_discrete(labels = c("dry \n (n = 96)", "mix \n (n = 59)", "riparian \n (n = 55)")) +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("grey90"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12)) + 
  labs(x = "Ecological landtype",
       y = "Number of species per site",
       title = "Species richness")

plot_sppr

```


End of R Markdown script.
